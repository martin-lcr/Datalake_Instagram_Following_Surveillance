{
  "description": "Configuration des dashboards Kibana pour la surveillance Instagram",
  "dashboards": [
    {
      "id": "instagram-overview",
      "title": "Instagram Surveillance - Vue d'ensemble",
      "description": "Dashboard principal avec les métriques clés",
      "visualizations": [
        {
          "type": "metric",
          "title": "Total Followers",
          "index": "instagram_followers",
          "query": {
            "size": 0,
            "aggs": {
              "unique_followers": {
                "cardinality": {
                  "field": "username"
                }
              }
            }
          }
        },
        {
          "type": "metric",
          "title": "Total Following",
          "index": "instagram_following",
          "query": {
            "size": 0,
            "aggs": {
              "unique_following": {
                "cardinality": {
                  "field": "username"
                }
              }
            }
          }
        },
        {
          "type": "line",
          "title": "Évolution Followers/Following",
          "index": "instagram_followers,instagram_following",
          "query": {
            "size": 0,
            "aggs": {
              "timeline": {
                "date_histogram": {
                  "field": "scraped_at",
                  "calendar_interval": "day"
                },
                "aggs": {
                  "by_type": {
                    "terms": {
                      "field": "data_type"
                    }
                  }
                }
              }
            }
          }
        },
        {
          "type": "pie",
          "title": "Répartition par Genre - Followers",
          "index": "instagram_followers",
          "query": {
            "size": 0,
            "aggs": {
              "gender_distribution": {
                "terms": {
                  "field": "predicted_gender"
                }
              }
            }
          }
        },
        {
          "type": "pie",
          "title": "Répartition par Genre - Following",
          "index": "instagram_following",
          "query": {
            "size": 0,
            "aggs": {
              "gender_distribution": {
                "terms": {
                  "field": "predicted_gender"
                }
              }
            }
          }
        }
      ]
    },
    {
      "id": "instagram-daily-changes",
      "title": "Instagram Surveillance - Changements Quotidiens",
      "description": "Suivi des ajouts et suppressions quotidiens",
      "visualizations": [
        {
          "type": "bar",
          "title": "Ajouts/Suppressions par Jour",
          "index": "instagram_daily_diff",
          "query": {
            "size": 0,
            "aggs": {
              "by_date": {
                "terms": {
                  "field": "comparison_date",
                  "order": {
                    "_key": "desc"
                  },
                  "size": 30
                },
                "aggs": {
                  "by_change_type": {
                    "terms": {
                      "field": "change_type"
                    }
                  }
                }
              }
            }
          }
        },
        {
          "type": "table",
          "title": "Derniers Followers Ajoutés",
          "index": "instagram_daily_diff",
          "query": {
            "size": 20,
            "query": {
              "bool": {
                "must": [
                  {
                    "term": {
                      "data_type": "followers"
                    }
                  },
                  {
                    "term": {
                      "change_type": "added"
                    }
                  }
                ]
              }
            },
            "sort": [
              {
                "comparison_date": {
                  "order": "desc"
                }
              }
            ]
          },
          "columns": ["username", "full_name", "predicted_gender", "confidence", "comparison_date"]
        },
        {
          "type": "table",
          "title": "Derniers Followers Supprimés",
          "index": "instagram_daily_diff",
          "query": {
            "size": 20,
            "query": {
              "bool": {
                "must": [
                  {
                    "term": {
                      "data_type": "followers"
                    }
                  },
                  {
                    "term": {
                      "change_type": "deleted"
                    }
                  }
                ]
              }
            },
            "sort": [
              {
                "comparison_date": {
                  "order": "desc"
                }
              }
            ]
          },
          "columns": ["username", "full_name", "predicted_gender", "confidence", "comparison_date"]
        },
        {
          "type": "pie",
          "title": "Répartition Genre - Ajouts Récents",
          "index": "instagram_daily_diff",
          "query": {
            "size": 0,
            "query": {
              "term": {
                "change_type": "added"
              }
            },
            "aggs": {
              "gender_distribution": {
                "terms": {
                  "field": "predicted_gender"
                }
              }
            }
          }
        }
      ]
    },
    {
      "id": "instagram-gender-analysis",
      "title": "Instagram Surveillance - Analyse de Genre",
      "description": "Analyse détaillée de la répartition par genre",
      "visualizations": [
        {
          "type": "metric",
          "title": "% Hommes - Followers",
          "index": "instagram_followers",
          "query": {
            "size": 0,
            "query": {
              "term": {
                "predicted_gender": "male"
              }
            }
          }
        },
        {
          "type": "metric",
          "title": "% Femmes - Followers",
          "index": "instagram_followers",
          "query": {
            "size": 0,
            "query": {
              "term": {
                "predicted_gender": "female"
              }
            }
          }
        },
        {
          "type": "bar",
          "title": "Confiance de Prédiction par Genre",
          "index": "instagram_followers,instagram_following",
          "query": {
            "size": 0,
            "aggs": {
              "by_gender": {
                "terms": {
                  "field": "predicted_gender"
                },
                "aggs": {
                  "avg_confidence": {
                    "avg": {
                      "field": "confidence"
                    }
                  }
                }
              }
            }
          }
        },
        {
          "type": "line",
          "title": "Évolution de la Répartition par Genre",
          "index": "instagram_followers",
          "query": {
            "size": 0,
            "aggs": {
              "timeline": {
                "date_histogram": {
                  "field": "scraped_at",
                  "calendar_interval": "day"
                },
                "aggs": {
                  "by_gender": {
                    "terms": {
                      "field": "predicted_gender"
                    }
                  }
                }
              }
            }
          }
        }
      ]
    }
  ],
  "index_patterns": [
    {
      "id": "instagram_followers",
      "title": "instagram_followers*",
      "timeFieldName": "scraped_at"
    },
    {
      "id": "instagram_following",
      "title": "instagram_following*",
      "timeFieldName": "scraped_at"
    },
    {
      "id": "instagram_daily_diff",
      "title": "instagram_daily_diff*",
      "timeFieldName": "comparison_date"
    }
  ]
}
